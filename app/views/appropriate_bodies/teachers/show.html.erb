<% page_data(title: Teachers::Name.new(@teacher).full_name, error: false) %>

<div class="govuk-button-group">
  <%= govuk_button_link_to("Release ECT", new_ab_teacher_release_ect_path(@teacher), secondary: true) %>
  <%= govuk_button_link_to("Record induction outcome", new_ab_teacher_record_outcome_path(@teacher), secondary: true) %>
  <%= govuk_button_link_to("Add an extension", "#", secondary: true) %>

</div>

<h2 class="govuk-heading-m">Early career teacher<h2>

<%=
  govuk_summary_list do |sl|
    sl.with_row do |row|
      row.with_key(text: "Name")
      row.with_value(text: Teachers::Name.new(@teacher).full_name)
    end

    sl.with_row do |row|
      row.with_key(text: "TRN")
      row.with_value(text: @teacher.trn)
    end

    sl.with_row do |row|
      row.with_key(text: "Induction status")

      # FIXME: This is a placeholder. The actual status should be displayed here.
      row.with_value(text: govuk_tag(text: "placeholder", colour: %w[grey green red purple orange yellow].sample))
    end
  end
%>

<% if @teacher.induction_periods_reported_by_appropriate_body.any? %>
  <h2 class="govuk-heading-m">Induction Summary<h2>
    <%=
    govuk_summary_list do |sl|
      sl.with_row do |row|
        row.with_key(text: "Induction start date")
        row.with_value(text: @teacher.induction_periods_reported_by_appropriate_body.last.started_on.to_fs(:govuk))
      end

      sl.with_row do |row|
        row.with_key(text: "Induction extended")
        row.with_value(text: @teacher.induction_extensions.any? ? "Yes" : "No")
      end

      sl.with_row do |row|
        row.with_key(text: "Expected terms to be completed")

        row.with_value(text: Teachers::TermsToBeCompleted.new(@teacher).number_of_terms)
      end
    end
  %>

  <h2 class="govuk-heading-m">Induction periods<h2>
    <%= govuk_table do |table|
      table.with_caption(size: 'm', text: '')

      table.with_head do |head|
        head.with_row do |row|
          row.with_cell(text: 'Appropriate body')
          row.with_cell(text: 'Induction programme')
          row.with_cell(text: 'Start date')
          row.with_cell(text: 'End date')
          row.with_cell(text: 'Number of terms', numeric: true)
        end
      end
      table.with_body do |body|
        @teacher.induction_periods_reported_by_appropriate_body.each do |induction_period |
          body.with_row do |row|
            row.with_cell(text: induction_period.appropriate_body.name)
            row.with_cell(text: induction_programme_choice_name(induction_period.induction_programme))
            row.with_cell(text: induction_period.started_on.to_fs(:govuk))
            row.with_cell(text: induction_period.finished_on&.to_fs(:govuk))
            row.with_cell(text: induction_period.number_of_terms, numeric: true)
          end
        end
      end
    end %>
<% end %>

<% if @teacher.induction_extensions.any? %>
  <h2 class="govuk-heading-m">Induction periods<h2>
    <%= govuk_table do |table|
      table.with_caption(size: 'm', text: '')

      table.with_head do |head|
        head.with_row do |row|
          row.with_cell(text: 'Added on')
          row.with_cell(text: 'Number of terms')
          row.with_cell(text: '')
          row.with_cell(text: '')
        end
      end
      table.with_body do |body|
        @teacher.induction_extensions.order(created_at: :desc).each_with_index do |induction_extension, index |
          body.with_row do |row|
            row.with_cell(text: induction_extension.created_at.to_date.to_fs(:govuk))
            row.with_cell(text: induction_extension.extension_terms)
            if index.zero?
              row.with_cell(text: govuk_link_to("Update", "#"))
              row.with_cell(text: govuk_link_to("Remove", "#"))
            else
              row.with_cell(text: "")
              row.with_cell(text: "")
            end
          end
        end
      end
    end %>
<% end %>
